image: alpine/edge
secrets:
  - d66b1d1c-77da-4c7c-bd7a-afe0f83f34ed
  - cfc0975b-ca64-48e2-ae20-43767e03ab51
  - 9229a412-3c0c-4a6d-9149-b5ae7dde32dd
tasks:
  - info: |
      [ -z "$GITHUB_EVENT" ] || complete-build
      git version
  - clone:
      git clone --reference ./legacy --mirror https://git.sr.ht/~samwhited/legacy legacy.git
  - github: |
      cd legacy.git/
      cat ~/.ssh/github >> ~/.ssh/known_hosts
      GIT_SSH_COMMAND="ssh -i ~/.ssh/cfc0975b-ca64-48e2-ae20-43767e03ab51" git push --mirror git@github.com:mellium/legacy.git
